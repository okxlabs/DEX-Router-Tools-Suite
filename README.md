# Gas Estimation Tool

A Node.js tool for analyzing gas usage of `sellBase` and `sellQuote` function calls in Ethereum transaction traces using Foundry's `cast` command.

## Overview

This tool consists of two main scripts:
- **`index.js`** - Entry point that executes cast commands and orchestrates the analysis
- **`calculateGas.js`** - Analyzes trace files to extract gas usage for specific functions

## Prerequisites

1. **Node.js** - Make sure you have Node.js installed on your system
2. **Foundry** - Install Foundry toolkit which includes the `cast` command

## Installation

1. Clone or download this repository
2. Navigate to the project directory:
   ```bash
   cd gas-estimatation
   ```

## Usage

### Method 1: Using the Entry Point Script (Recommended)

Run the complete workflow with a single command by passing your entire `cast call` command as arguments:

```bash
node index.js cast call <contract_address> <function_signature> --from <address> --rpc-url <rpc_url> --block <block_number> --trace
```

#### Example:
```bash
node index.js cast call 0xd547eafde2410e63300fc5308ccea0b356e7b5d8 "0xb80c2f090000000000000000000000000000000000000000000000000038ebf6fc0528c0..." --from 0xf7745296976daeeed7b0143e212885af7bca6a10 --rpc-url https://bsc-dataseed.binance.org --block 68721363 --trace
```

This will:
1. Execute the cast call command with trace
2. Save the trace output to `trace.txt`
3. Automatically analyze the gas usage
4. Display the results

### Method 2: Manual Analysis

If you already have a trace file, you can analyze it directly:

```bash
node calculateGas.js
```

Make sure your trace file is named `trace.txt` and is in the same directory as the script.

## Output

The tool will display:

```
=== Ethereum Gas Analysis Tool ===

Executing cast call command...
Command: cast call 0x... --trace

Running cast call with trace...
✓ Trace saved to trace.txt

Analyzing gas usage...

=== Gas Usage Analysis ===

Function Calls: sellBase
Gas usage: 83869

=== Summary ===
Total sellBase/sellQuote function calls found: 1
Total gas usage: 83869
```

## What the Tool Does

1. **Searches for Functions**: Looks for `sellBase` and `sellQuote` function calls in the trace
2. **Extracts Gas Usage**: Finds the gas usage number in brackets `[xxx]` before each function call
3. **Individual Analysis**: Shows gas usage for each function call found
4. **Total Calculation**: Sums up all gas usage from `sellBase` and `sellQuote` functions
5. **Summary Report**: Provides a comprehensive summary of findings

## Trace File Format

The tool expects trace files in the format generated by Foundry's `cast call --trace` command:

```
Traces:
  [205247] 0xd547Eafde2410e63300Fc5308CceA0b356E7b5d8::smartSwapByOrderId(...)
    ├─ [83869] 0x7A7AD9aa93cd0A2D0255326E5Fb145CEc14997FF::sellBase(...)
    ├─ [45123] 0x7A7AD9aa93cd0A2D0255326E5Fb145CEc14997FF::sellQuote(...)
    └─ ← [Return] 0x...
```

## Error Handling

The tool provides helpful error messages for common issues:

- **Missing cast command**: Instructions for installing Foundry
- **RPC connection issues**: Suggestions to check network connectivity
- **Invalid block numbers**: Prompts to verify block number validity
- **Missing files**: Clear messages about required files

## Files Generated

- **`trace.txt`**: Contains the raw trace output from the cast command (automatically generated/replaced)

## Troubleshooting

### Cast command not found
```bash
# Install Foundry
curl -L https://foundry.paradigm.xyz | bash
foundryup
```

### RPC connection issues
- Verify your RPC URL is correct and accessible
- Check your internet connection
- Try a different RPC endpoint

### No functions found
- Ensure your transaction actually calls `sellBase` or `sellQuote` functions
- Verify the trace file format is correct
- Check that the `--trace` flag is included in your cast command

## Examples

### Basic Usage
```bash
node index.js cast call 0x1234... "0xabcd..." --from 0x5678... --rpc-url https://mainnet.infura.io/v3/YOUR_KEY --block 18500000 --trace
```

### BSC Network
```bash
node index.js cast call 0x1234... "0xabcd..." --from 0x5678... --rpc-url https://bsc-dataseed.binance.org --block 68721363 --trace
```

### Polygon Network
```bash
node index.js cast call 0x1234... "0xabcd..." --from 0x5678... --rpc-url https://polygon-rpc.com --block 50000000 --trace
```

## Contributing

Feel free to submit issues, feature requests, or pull requests to improve this tool.

## License

This project is open source and available under the MIT License.
